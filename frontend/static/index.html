<!doctype html>
<html lang="">

<head>  
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>

  <link rel="import" href="elements/elements.html">

  <link rel="import" href="elements/bet-box.html">

  <!-- Routing -->
  <link rel="import" href="elements/routing.html">

  <style>
    .betBox{
      display: inline-block;
      margin: 10px 0px 0px 10px;
    }
    .login{
      display: inline-block;
      margin-left: auto;
      margin-right: 0;
    }
    .username{
      display: inline-block;
    }
    .check{
      position: fixed;
      right: 20px;
      bottom: 20px;
      background-color: #EC407A;
      --paper-fab-background: #EC407A;
    }
    .tabs{
      margin: 0;
      width: 500px;
      text-transform: uppercase;
      
    }
    .tab{
      text-decoration: none;
      color:white;
    }
    .ranksUser{
      margin-left: 10%;
      margin-right: 10%;
      padding: 10px;
      border-bottom: 1px solid black;
    }
    .ranks{
      margin-left: 10%;
      margin-right: 10%;
      padding: 10px;
      border-bottom: 1px solid black;
      text-align: center;
    }
    .country{
      display: inline-block;
      text-align: center;
      margin-right: 5px;
    }
    a{
      color: inherit;
    }
  </style>
</head>

<body unresolved class="fullbleed layout vertical">
  <template is="dom-bind" id="app">
    <paper-header-panel main>
        <!-- Header toolbar -->
        <paper-toolbar>

          <paper-tabs class="tabs" attr-for-selected="data-route" selected="{{route}}" on-iron-select="onMenuSelect">
            <paper-tab link >
              <a data-route="bets" href="/" class="horizontal center-center layout tab">
                <span>Bets</span>
              </a>
            </paper-tab>
            <paper-tab link>
              <a data-route="userRanking" href="/userRanking" class="horizontal center-center layout tab">
                <span>User ranking</span>
              </a>
            </paper-tab>
            <paper-tab link>
              <a data-route="allRanking" href="/allRanking" class="horizontal center-center layout tab">
                <span>All ranking</span>
              </a>
            </paper-tab>            
          </paper-tabs>
          <!-- show current account and login option -->  
          <div class="login">
            <p class="username">Login</p>
            <a href="login.html" id="login"><paper-icon-button icon="account-circle" class="account"></paper-icon-button></a>
          </div>

        </paper-toolbar>

        <!-- Header content -->
        <!-- Pages of the website -->
        <iron-pages attr-for-selected="data-route" selected="{{route}}">
        
          <!-- 1) boxes containing the games -->
          <section data-route="bets">
            <div class="betsContainer" vertical layout center>
              <iron-ajax auto url="games.json" handle-as="json" last-response="{{games}}"></iron-ajax>
              <template is="dom-repeat" items="{{games}}" as="game">
                <bet-box flag1="{{game.country1.urlFlag}}" 
                         flag2="{{game.country2.urlFlag}}"
                         pays1="{{game.country1.isoCode}}"
                         pays2="{{game.country2.isoCode}}"></bet-box>
             
              </template>

              <span id="test"></span>
            </div>        

            <paper-fab icon="check" class="check"></paper-fab>
            <paper-toast text="Bet for every game" id="notAll"></paper-toast>
          </section>

          <!-- 2) User ranking -->
          <section data-route="userRanking">
            <div class="ranksUser">
              <h3>Winner</h3>
              <div class="country">
                <iron-image style="width:200px; height:150px;" sizing="cover" src="img/flags/fr.png"></iron-image>
                <p>France</p>
              </div>          
            </div>

            <div class="ranksUser">
              <h3>Final</h3>
              <div class="country">
                <iron-image style="width:125px; height:95px;" sizing="cover" src="img/flags/de.png"></iron-image>
                <p>Germany</p>  
              </div>
              <div class="country">
                <iron-image style="width:125px; height:95px;" sizing="cover" src="img/flags/fr.png"></iron-image>
                <p>France</p>  
              </div>              
            </div> 
          </section>

          <!-- 3) All ranking -->
          <section data-route="allRanking">
            <div class="ranks">
              <h3>1st</h3>
              <iron-image style="width:200px; height:150px;" sizing="cover" src="img/flags/fr.png"></iron-image>
              <p>France</p>
              <p>Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A,</p>         
            </div>

            <div class="ranks">
              <h3>2nd</h3>
              <iron-image style="width:150px; height:113px;" sizing="cover" src="img/flags/de.png"></iron-image>
              <p>Germany</p>
              <p>Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A, Pseudo A,</p>         
            </div>
          </section>

          
        </iron-pages>
      </paper-header-panel>  
  </template>
</body>

</html>
<script>
  $(document).ready(function(){
    $(".username").text($.session.get("session"));

    $(".check").click(function(){
      var winners =[];
      $("bet-box").each(function(){
        var result = $(this).get(0).winner;
        if(result != undefined){
          winners.push({"country" : result.slice(12,14)});  
        }        
      });
      console.log(winners);
      if(winners.length != 2){
        document.querySelector("#notAll").show();
      }
    });
  });

  function checkSession(){
    var checksession = $.session.get('session');
    console.log(checksession);
    if(checksession == undefined){
      window.location.replace("login.html")
    }
    $(".username").text($.session.get("session"));
  }
</script>